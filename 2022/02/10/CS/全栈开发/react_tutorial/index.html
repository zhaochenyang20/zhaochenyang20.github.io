<!DOCTYPE html><html lang="en-US" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>React 入坟 | 求道之人，不问寒暑</title><meta name="keywords" content="2022寒假,前端,软工,JavaScript"><meta name="author" content="Eren Zhao"><meta name="copyright" content="Eren Zhao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="为了 discover web 进行一次 react 的 bitch 的 fly">
<meta property="og:type" content="article">
<meta property="og:title" content="React 入坟">
<meta property="og:url" content="http://example.com/2022/02/10/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/react_tutorial/index.html">
<meta property="og:site_name" content="求道之人，不问寒暑">
<meta property="og:description" content="为了 discover web 进行一次 react 的 bitch 的 fly">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/03/08/jPxmqXH5YvbsgOu.png">
<meta property="article:published_time" content="2022-02-10T02:46:45.562Z">
<meta property="article:modified_time" content="2022-03-07T02:28:31.912Z">
<meta property="article:author" content="Eren Zhao">
<meta property="article:tag" content="2022寒假">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="软工">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/03/08/jPxmqXH5YvbsgOu.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2022/02/10/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/react_tutorial/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'React 入坟',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-07 10:28:31'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}</style></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend.jpg'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">168</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">53</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/03/08/jPxmqXH5YvbsgOu.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">求道之人，不问寒暑</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">React 入坟</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-02-10T02:46:45.562Z" title="Created 2022-02-10 10:46:45">2022-02-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-03-07T02:28:31.912Z" title="Updated 2022-03-07 10:28:31">2022-03-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/">全栈开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">10.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>39min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="React 入坟"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="readme">readme</h1>
<p>此文档参考了 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/tutorial/tutorial.html">react 官方教程</a></p>
<p>本来是为了 discover web 做准备，顺手为软工做准备</p>
<p>还参考了<a target="_blank" rel="noopener" href="https://cloud.tsinghua.edu.cn/d/276d435f204c429c9432/">贵系科协暑培的资料</a>，不过那个更加 fly bitch</p>
<h1 id="课程前言">课程前言</h1>
<ul>
<li>我们一起用 React 开发一个井字棋（tic-tac-toe）</li>
<li>先修要求：HTML 和 JavaScript：函数、对象、数组，以及 class 。</li>
<li>业界名著——<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/A_re-introduction_to_JavaScript">重新介绍 JavaScript</a></li>
</ul>
<h1 id="搭环境">搭环境</h1>
<p>官方教程给了<a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/oWWQNa?editors=0010">基本的模板</a>，但是软工显然不能这么玩儿，所以以下展示给 React 搭环境的过程。</p>
<ul>
<li>搭配 node.js 和 npm</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; node -v</span><br><span class="line">v15.14.0</span><br><span class="line">&gt; npm -v</span><br><span class="line">7.7.6</span><br></pre></td></tr></table></figure>
<ul>
<li>Create React App</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; npx create-react-app React_tutor</span><br><span class="line">Need to install the following packages:</span><br><span class="line">  create-react-app</span><br><span class="line">Ok to proceed? (y) y</span><br><span class="line">npm WARN deprecated tar@2.2.2: This version of tar is no longer supported, and will not receive security updates. Please upgrade asap.</span><br><span class="line">Cannot create a project named <span class="string">&quot;React_tutor&quot;</span> because of npm naming restrictions:</span><br><span class="line"></span><br><span class="line">  * name can no longer contain capital letters</span><br><span class="line"></span><br><span class="line">Please choose a different project name.</span><br><span class="line">npm notice</span><br><span class="line">npm notice New major version of npm available! 7.7.6 -&gt; 8.4.1</span><br><span class="line">npm notice Changelog: https://github.com/npm/cli/releases/tag/v8.4.1</span><br><span class="line">npm notice Run npm install -g npm@8.4.1 to update!</span><br><span class="line">npm notice</span><br></pre></td></tr></table></figure>
<p>换个名字，居然不能用大写，我淦</p>
<p>贼慢，估计得用全局代理，但是我全局代理老是搞不好，麻了</p>
<p>先把概念学了：</p>
<blockquote>
<p>Create React App 不会处理后端逻辑或操纵数据库；它只是创建一个前端构建流水线（build pipeline），所以你可以使用它来配合任何你想使用的后端。它在内部使用 <a target="_blank" rel="noopener" href="https://babeljs.io/">Babel</a> 和 <a target="_blank" rel="noopener" href="https://webpack.js.org/">webpack</a>，但你无需了解它们的任何细节。</p>
<p>当你准备好部署到生产环境时，执行 <code>npm run build</code> 会在 <code>build</code> 文件夹内生成你应用的优化版本。你能<a target="_blank" rel="noopener" href="https://github.com/facebookincubator/create-react-app#create-react-app--">从它的 README</a> 和<a target="_blank" rel="noopener" href="https://facebook.github.io/create-react-app/">用户指南</a>了解 Create React App 的更多信息。</p>
</blockquote>
<h1 id="javascript-构建工具链">JavaScript 构建工具链</h1>
<p>一组 JavaScript 构建工具链通常由这些组成：</p>
<ul>
<li>一个 <strong>package 管理器</strong>，比如 <a target="_blank" rel="noopener" href="https://yarnpkg.com/">Yarn</a> 或 <a target="_blank" rel="noopener" href="https://www.npmjs.com/">npm</a>。它能让你充分利用庞大的第三方 package 的生态系统，并且轻松地安装或更新它们。</li>
<li>一个<strong>打包器</strong>，比如 <a target="_blank" rel="noopener" href="https://webpack.js.org/">webpack</a> 或 <a target="_blank" rel="noopener" href="https://parceljs.org/">Parcel</a>。它能让你编写模块化代码，并将它们组合在一起成为小的 package，以优化加载时间。</li>
<li>一个<strong>编译器</strong>，例如 <a target="_blank" rel="noopener" href="https://babeljs.io/">Babel</a>。它能让你编写的新版本 JavaScript 代码，在旧版浏览器中依然能够工作。</li>
</ul>
<h1 id="npm-换源">npm 换源</h1>
<p>破防了，全局代理开不好，还是给 npm 换源好了</p>
<p>这个网站太强大了，<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000023288827">换所有的源</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org/</span><br><span class="line">yarn config <span class="built_in">set</span> registry https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure>
<p>换成阿里的源，貌似没找到 tuna 的源</p>
<p>然后：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; npx create-react-app react_tutor</span><br><span class="line"></span><br><span class="line">Creating a new React app <span class="keyword">in</span> /Users/zhaochen20/CST_THU/2022_winter/前后端/react_tutor.</span><br><span class="line"></span><br><span class="line">Installing packages. This might take a couple of minutes.</span><br><span class="line">Installing react, react-dom, and react-scripts with cra-template...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">added 1368 packages <span class="keyword">in</span> 27s</span><br><span class="line">npm notice</span><br><span class="line">npm notice New major version of npm available! 7.7.6 -&gt; 8.4.1</span><br><span class="line">npm notice Changelog: https://github.com/npm/cli/releases/tag/v8.4.1</span><br><span class="line">npm notice Run npm install -g npm@8.4.1 to update!</span><br><span class="line">npm notice</span><br><span class="line"></span><br><span class="line">Initialized a git repository.</span><br><span class="line">-------------------</span><br><span class="line">.....</span><br><span class="line">-------------------</span><br><span class="line">removed 1 package <span class="keyword">in</span> 2s</span><br><span class="line">npm notice</span><br><span class="line">npm notice New major version of npm available! 7.7.6 -&gt; 8.4.1</span><br><span class="line">npm notice Changelog: https://github.com/npm/cli/releases/tag/v8.4.1</span><br><span class="line">npm notice Run npm install -g npm@8.4.1 to update!</span><br><span class="line">npm notice</span><br><span class="line"></span><br><span class="line">Created git commit.</span><br><span class="line"></span><br><span class="line">Success! Created react_tutor at /Users/zhaochen20/CST_THU/2022_winter/前后端/react_tutor</span><br><span class="line">Inside that directory, you can run several commands:</span><br><span class="line"></span><br><span class="line">  npm start</span><br><span class="line">    Starts the development server.</span><br><span class="line"></span><br><span class="line">  npm run build</span><br><span class="line">    Bundles the app into static files <span class="keyword">for</span> production.</span><br><span class="line"></span><br><span class="line">  npm <span class="built_in">test</span></span><br><span class="line">    Starts the <span class="built_in">test</span> runner.</span><br><span class="line"></span><br><span class="line">  npm run eject</span><br><span class="line">    Removes this tool and copies build dependencies, configuration files</span><br><span class="line">    and scripts into the app directory. If you <span class="keyword">do</span> this, you can’t go back!</span><br><span class="line"></span><br><span class="line">We suggest that you begin by typing:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">cd</span> react_tutor</span><br><span class="line">  npm start</span><br><span class="line"></span><br><span class="line">Happy hacking!</span><br><span class="line">npm notice</span><br><span class="line">npm notice New major version of npm available! 7.7.6 -&gt; 8.4.1</span><br><span class="line">npm notice Changelog: https://github.com/npm/cli/releases/tag/v8.4.1</span><br><span class="line">npm notice Run npm install -g npm@8.4.1 to update!</span><br><span class="line">npm notice</span><br><span class="line">---------------</span><br><span class="line">&gt; npm start</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://pic.imgdb.cn/item/6204c6442ab3f51d912f0f9a.jpg" style="zoom:25%;" /></p>
<h1 id="概览">概览</h1>
<h2 id="what-is-react">What is React</h2>
<p>React 是一个<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%AE%A3%E5%91%8A%E5%BC%8F%E7%B7%A8%E7%A8%8B">声明式</a>，高效且灵活的用于构建用户界面的 JavaScript 库。使用 React 可以将一些简短、独立的代码片段组合成复杂的 UI 界面，这些代码片段被称作“组件”。</p>
<p>React 中拥有多种不同类型的组件，我们先从 <code>React.Component</code> 的子类开始介绍：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">class ShoppingList extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;shopping-list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Shopping List for &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>Instagram<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>WhatsApp<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>Oculus<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 用法示例: <span class="tag">&lt;<span class="name">ShoppingList</span> <span class="attr">name</span>=<span class="string">&quot;Mark&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们马上会讨论这些又奇怪、又像 XML 的标签。我们通过使用组件来告诉 React 我们希望在屏幕上看到什么。当数据发生改变时，React 会高效地更新并重新渲染我们的组件。</p>
<p>其中，ShoppingList 是一个 <strong>React 组件类</strong>，或者说是一个 <strong>React 组件类型</strong>。一个组件接收一些参数，我们把这些参数叫做 <code>props</code>（“props” 是 “properties” 简写），然后通过 <code>render</code> 方法返回需要展示在屏幕上的视图的层次结构。（render 这个词很像 django）</p>
<p><code>render</code> 方法的返回值<em>描述</em>了你希望在屏幕上看到的内容。React 根据描述，然后把结果展示出来。更具体地来说，<code>render</code> 返回了一个 <strong>React 元素</strong>，这是一种对渲染内容的轻量级描述。大多数的 React 开发者使用了一种名为 “JSX” 的特殊语法，JSX 可以让你更轻松地书写这些结构。语法 <code>&lt;div /&gt;</code> 会被编译成 <code>React.createElement('div')</code>。上述的代码等同于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> React.createElement(<span class="string">&#x27;div&#x27;</span>, &#123;<span class="attr">className</span>: <span class="string">&#x27;shopping-list&#x27;</span>&#125;,</span><br><span class="line">  React.createElement(<span class="string">&#x27;h1&#x27;</span>, <span class="comment">/* ... h1 children ... */</span>),</span><br><span class="line">  React.createElement(<span class="string">&#x27;ul&#x27;</span>, <span class="comment">/* ... ul children ... */</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>在 JSX 中你可以任意使用 JavaScript 表达式，只需要用一个大括号把表达式括起来。每一个 React 元素事实上都是一个 JavaScript 对象，你可以在你的程序中把它保存在变量中或者作为参数传递。</p>
<p>前文中的 <code>ShoppingList</code> 组件只会渲染一些内置的 DOM 组件，如<code>&lt;div /&gt;</code>、<code>&lt;li /&gt;</code>等。但是你也可以组合和渲染自定义的 React 组件。例如，你可以通过 <code>&lt;ShoppingList /&gt;</code> 来表示整个购物清单组件。每个组件都是封装好的，并且可以单独运行，这样你就可以通过组合简单的组件来构建复杂的 UI 界面。</p>
<h2 id="初始代码">初始代码</h2>
<p>官方教程太不靠谱了，完全不说实例代码应该放在哪个位置，实际上，应该放在 js 代码放在 index.js 下面，css 放在 index.css，最后 html 放在<code>project_root/public/index.html</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">----------------</span><br><span class="line">index.js</span><br><span class="line">----------------</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reportWebVitals <span class="keyword">from</span> <span class="string">&#x27;./reportWebVitals&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* TODO */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Square</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> status = <span class="string">&#x27;Next player: X&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;status&quot;</span>&gt;</span>&#123;status&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(0)&#125;</span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(1)&#125;</span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(2)&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(3)&#125;</span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(4)&#125;</span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(5)&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(6)&#125;</span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(7)&#125;</span></span><br><span class="line"><span class="xml">                    &#123;this.renderSquare(8)&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Board</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* status */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ol</span>&gt;</span>&#123;/* TODO */&#125;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========================================</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Game</span> /&gt;</span></span>,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// If you want to start measuring performance in your app, pass a function</span></span><br><span class="line"><span class="comment">// to log results (for example: reportWebVitals(console.log))</span></span><br><span class="line"><span class="comment">// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals</span></span><br><span class="line">reportWebVitals();</span><br><span class="line"></span><br><span class="line">----------------</span><br><span class="line">index.css</span><br><span class="line">----------------</span><br><span class="line">body &#123;</span><br><span class="line">  <span class="attr">font</span>: 14px <span class="string">&quot;Century Gothic&quot;</span>, Futura, sans-serif;</span><br><span class="line">  margin: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ol, ul &#123;</span><br><span class="line">  padding-left: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.board-row:after &#123;</span><br><span class="line">  <span class="attr">clear</span>: both;</span><br><span class="line">  content: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  display: table;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.status &#123;</span><br><span class="line">  margin-bottom: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.square &#123;</span><br><span class="line">  <span class="attr">background</span>: #fff;</span><br><span class="line">  border: 1px solid #<span class="number">999</span>;</span><br><span class="line">  float: left;</span><br><span class="line">  font-size: 24px;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">  line-height: 34px;</span><br><span class="line">  height: 34px;</span><br><span class="line">  margin-right: -1px;</span><br><span class="line">  margin-top: -1px;</span><br><span class="line">  padding: <span class="number">0</span>;</span><br><span class="line">  text-align: center;</span><br><span class="line">  width: 34px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.square:focus &#123;</span><br><span class="line">  <span class="attr">outline</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.kbd-navigation .square:focus &#123;</span><br><span class="line">  <span class="attr">background</span>: #ddd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.game &#123;</span><br><span class="line">  <span class="attr">display</span>: flex;</span><br><span class="line">  flex-direction: row;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.game-info &#123;</span><br><span class="line">  margin-left: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------</span><br><span class="line">index.html</span><br><span class="line">-----------</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;errors&quot;</span> <span class="attr">style</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">  background: #c00;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">  color: #fff;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">  display: none;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">  margin: -20px -20px 20px;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">  padding: 20px;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">  white-space: pre-wrap;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;mousedown&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="built_in">document</span>.body.classList.add(<span class="string">&#x27;mouse-navigation&#x27;</span>);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="built_in">document</span>.body.classList.remove(<span class="string">&#x27;kbd-navigation&#x27;</span>);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;);</span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;keydown&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="keyword">if</span> (e.keyCode === <span class="number">9</span>) &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="built_in">document</span>.body.classList.add(<span class="string">&#x27;kbd-navigation&#x27;</span>);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="built_in">document</span>.body.classList.remove(<span class="string">&#x27;mouse-navigation&#x27;</span>);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;);</span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="keyword">if</span> (e.target.tagName === <span class="string">&#x27;A&#x27;</span> &amp;&amp; e.target.getAttribute(<span class="string">&#x27;href&#x27;</span>) === <span class="string">&#x27;#&#x27;</span>) &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    e.preventDefault();</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;);</span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="built_in">window</span>.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">message, source, line, col, error</span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="keyword">var</span> text = error ? error.stack || error : message + <span class="string">&#x27; (at &#x27;</span> + source + <span class="string">&#x27;:&#x27;</span> + line + <span class="string">&#x27;:&#x27;</span> + col + <span class="string">&#x27;)&#x27;</span>;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  errors.textContent += text + <span class="string">&#x27;\n&#x27;</span>;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  errors.style.display = <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;;</span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="built_in">console</span>.error = (<span class="function"><span class="keyword">function</span>(<span class="params">old</span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params"></span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    errors.textContent += <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>).join(<span class="string">&#x27; &#x27;</span>) + <span class="string">&#x27;\n&#x27;</span>;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    errors.style.display = <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    old.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;)(<span class="built_in">console</span>.error);</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>本地的效果为：</p>
<p><img src="https://pic.imgdb.cn/item/6204cdd82ab3f51d913987dd.jpg" /></p>
<p>这些初始代码是我们要开发的小游戏的基础代码。我们已经提供了 CSS 样式，这样你只需要关注使用 React 来开发这个井字棋了。</p>
<p>通过阅读代码，你可以看到我们有三个 React 组件：</p>
<ul>
<li>Square</li>
<li>Board</li>
<li>Game</li>
</ul>
<p>Square 组件渲染了一个单独的 <code>&lt;button&gt;</code>。Board 组件渲染了 9 个方块。Game 组件渲染了含有默认值的一个棋盘，我们一会儿会修改这些值。到目前为止还没有可以交互的组件。</p>
<h2 id="通过-props-传递数据">通过 Props 传递数据</h2>
<p>让我们试试水，尝试将数据从 Board 组件传递到 Square 组件中。</p>
<p>强烈建议你动手编写本教程中的代码，不要使用复制/粘贴，这将加深你对 React 的记忆和理解。</p>
<p>在 Board 组件的 <code>renderSquare</code> 方法中，我们将代码改写成下面这样，传递一个名为 <code>value</code> 的 prop 到 Square 当中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Square</span> <span class="attr">value</span>=<span class="string">&#123;i&#125;</span> /&gt;</span></span>;  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改 Square 组件中的 <code>render</code> 方法，把 <code>&#123;/* TODO */&#125;</code> 替换为 <code>&#123;this.props.value&#125;</code>，以显示上文中传入的值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.props.value&#125;      </span></span><br><span class="line"><span class="xml">  		<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://zh-hans.reactjs.org/static/685df774da6da48f451356f33f4be8b2/01bf6/tictac-numbers.png" /></p>
<p>修改后的渲染结果如上。</p>
<h2 id="给组件添加交互功能">给组件添加交互功能</h2>
<p>接下来我们试着让棋盘的每一个格子在点击之后能落下一颗 “X” 作为棋子。 首先，我们把 Square 组件中 <code>render()</code> 方法的返回值中的 button 标签修改为如下内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;function()</span> &#123; <span class="attr">console.log</span>(&#x27;<span class="attr">click</span>&#x27;); &#125;&#125;&gt;</span>        &#123;this.props.value&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果此刻点击某个格子，将在浏览器的开发者工具中打印 ‘click’。</p>
<p>效果如下：</p>
<p><img src="https://pic.imgdb.cn/item/6205bcaf2ab3f51d91ffe1c0.jpg" /></p>
<hr />
<p>为了少输入代码，同时为了避免 <a target="_blank" rel="noopener" href="https://yehudakatz.com/2011/08/11/understanding-javascript-function-invocation-and-this/"><code>this</code> 造成的困扰</a>，我们在这里使用<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions">箭头函数</a> 来进行事件处理，如下所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> console.log(&#x27;click&#x27;)&#125;&gt;       &#123;this.props.value&#125;</span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：此处使用了 <code>onClick=&#123;() =&gt; console.log('click')&#125;</code> 的方式向 <code>onClick</code> 这个 prop 传入一个<em>函数</em>。 React 将在单击时调用此函数。但很多人经常忘记编写 <code>() =&gt;</code>，而写成了 <code>onClick=&#123;console.log('click')&#125;</code>，这种常见的错误会导致每次这个组件渲染的时候都会触发控制台输出。</p>
<hr />
<p>接下来，我们希望 Square 组件可以“记住”它被点击过，然后用 “X” 来填充对应的方格。我们用 <strong>state</strong> 来实现所谓“记忆”的功能。</p>
<p>可以通过在 React 组件的构造函数中设置 <code>this.state</code> 来初始化 state。<code>this.state</code> 应该被视为一个组件的私有属性。我们在 <code>this.state</code> 中存储当前每个方格（Square）的值，并且在每次方格被点击的时候改变这个值。</p>
<p>首先，我们向这个 class 中添加一个构造函数，用来初始化 state：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">lass Square <span class="keyword">extends</span> React.Component &#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;    <span class="built_in">super</span>(props);    <span class="built_in">this</span>.state = &#123;      <span class="attr">value</span>: <span class="literal">null</span>,    &#125;;  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> console.log(&#x27;click&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="xml">        &#123;this.props.value&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<ul>
<li><p>注意</p>
<p>在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes">JavaScript class</a> 中，每次你定义其子类的构造函数时，都需要调用 <code>super</code> 方法。因此，在所有含有构造函数的的 React 组件中，构造函数必须以 <code>super(props)</code> 开头。</p></li>
</ul>
<hr />
<p>现在，我们来修改一下 Square 组件的 <code>render</code> 方法，这样，每当方格被点击的时候，就可以显示当前 state 的值了：</p>
<ul>
<li>在 <code>&lt;button&gt;</code> 标签中，把 <code>this.props.value</code> 替换为 <code>this.state.value</code>。</li>
<li>将 <code>onClick=&#123;...&#125;</code> 事件监听函数替换为 <code>onClick=&#123;() =&gt; this.setState(&#123;value: 'X'&#125;)&#125;</code>。</li>
<li>为了更好的可读性，将 <code>className</code> 和 <code>onClick</code> 的 prop 分两行书写。</li>
</ul>
<p>修改之后，Square 组件中 <code>render</code> 方法的返回值中的 <code>&lt;button&gt;</code> 标签就变成了下面这样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">className</span>=<span class="string">&quot;square&quot;</span>        </span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.setState(&#123;value: &#x27;X&#x27;&#125;)&#125;      </span></span><br><span class="line"><span class="xml">  		&gt;</span></span><br><span class="line"><span class="xml">        &#123;this.state.value&#125;      </span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 Square 组件 <code>render</code> 方法中的 <code>onClick</code> 事件监听函数中调用 <code>this.setState</code>，我们就可以在每次 <code>&lt;button&gt;</code> 被点击的时候通知 React 去重新渲染 Square 组件。组件更新之后，Square 组件的 <code>this.state.value</code> 的值会变为 <code>'X'</code>，因此，我们在游戏棋盘上就能看见 <code>X</code> 了。点击任意一个方格，<code>X</code> 就会出现了。</p>
<p>每次在组件中调用 <code>setState</code> 时，React 都会自动更新其子组件。</p>
<h2 id="开发者工具">开发者工具</h2>
<p>在 <a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en">Chrome</a> 或者 <a target="_blank" rel="noopener" href="https://addons.mozilla.org/en-US/firefox/addon/react-devtools/">Firefox</a> 中安装扩展 React Devtools 可以让你在浏览器开发者工具中查看 React 的组件树。</p>
<p><img src="https://pic.imgdb.cn/item/6205bfeb2ab3f51d9102a03a.jpg" /></p>
<p>你还可以在 React DevTools 中检查 React 组件的 state 和 props。</p>
<p>安装 React DevTools 之后，右键点击页面的任何一个元素，然后选择“查看”，这样就能打开浏览器的开发者工具了，并且工具栏最后会多展示一个 React 的选项卡（包含 “⚛️ Components” 和 “⚛️ Profiler”）。你可以使用 “⚛️ Components” 来检查组件树。</p>
<h1 id="游戏完善">游戏完善</h1>
<p>我们现在已经编写好了井字棋游戏中，最基础的可以落子的棋盘。为了开发一个完整的游戏，我们还需要交替在棋盘上放置 “X” 和 “O”，并且判断出胜者。</p>
<h2 id="状态提升">状态提升</h2>
<p>当前，每个 Square 组件都维护了游戏的状态。我们可以把所有 9 个 Square 的值放在一个地方，这样我们就可以判断出胜者了。</p>
<p>你可能会想，我们也可以在棋盘 Board 组件中收集每个格子 Square 组件中的 state。虽然技术上来讲是可以实现的，但是代码如此编写会让人很难理解，并且我们以后想要维护重构时也会非常困难。所以，最好的解决方式是直接将所有的 state 状态数据存储在 Board 父组件当中。之后 Board 组件可以将这些数据通过 props 传递给各个 Square 子组件，<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/tutorial/tutorial.html#passing-data-through-props">正如上文我们把数字传递给每一个 Square 一样</a>。</p>
<p><strong>当你遇到需要同时获取多个子组件数据，或者两个组件之间需要相互通讯的情况时，需要把子组件的 state 数据提升至其共同的父组件当中保存。之后父组件可以通过 props 将状态数据传递到子组件当中。这样应用当中所有组件的状态数据就能够更方便地同步共享了。</strong></p>
<p>像这种将组件的 state 提升到父组件的情形在重构 React 组件时经常会遇到 —— 借此我们来实践一下。</p>
<p>为 Board 组件添加构造函数，将 Board 组件的初始状态设置为长度为 9 的空值数组：</p>
<hr />
<p>为了提高可读性，我们把返回的 React 元素拆分成了多行，同时在最外层加了小括号，这样 JavaScript 解析的时候就不会在 <code>return</code> 的后面自动插入一个分号从而破坏代码结构了。</p>
<hr />
<p>现在我们从 Board 组件向 Square 组件中传递两个 props 参数：<code>value</code> 和 <code>onClick</code>。<code>onClick</code> prop 是一个 Square 组件点击事件监听函数。接下来，我们需要修改 Square 的代码：</p>
<ul>
<li>将 Square 组件的 <code>render</code> 方法中的 <code>this.state.value</code> 替换为 <code>this.props.value</code> 。</li>
<li>将 Square 组件的 <code>render</code> 方法中的 <code>this.setState()</code> 替换为 <code>this.props.onClick()</code> 。</li>
<li>删掉 Square 组件中的构造函数 <code>constructor</code>，因为该组件不需要再保存游戏的 state。</li>
</ul>
<p>进行上述修改之后，代码会变成下面这样:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;  </span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">className</span>=<span class="string">&quot;square&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.props.onClick()&#125;      </span></span><br><span class="line"><span class="xml">      &gt;</span></span><br><span class="line"><span class="xml">        &#123;this.props.value&#125;      </span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每一个 Square 被点击时，Board 提供的 <code>onClick</code> 函数就会触发。我们回顾一下这是怎么实现的：</p>
<ol type="1">
<li>向 DOM 内置元素 <code>&lt;button&gt;</code> 添加 <code>onClick</code> prop，让 React 开启对点击事件的监听。</li>
<li>当 button 被点击时，React 会调用 Square 组件的 <code>render()</code> 方法中的 <code>onClick</code> 事件处理函数。</li>
<li>事件处理函数触发了传入其中的 <code>this.props.onClick()</code> 方法。这个方法是由 Board 传递给 Square 的。</li>
<li>由于 Board 把 <code>onClick=&#123;() =&gt; this.handleClick(i)&#125;</code> 传递给了 Square，所以当 Square 中的事件处理函数触发时，其实就是触发的 Board 当中的 <code>handleClick(i)</code> 方法。</li>
<li>现在我们还尚未定义 <code>handleClick()</code> 方法，所以代码还不能正常工作。如果此时点击 Square，你会在屏幕上看到红色的错误提示，提示内容为：“this.handleClick is not a function”。</li>
</ol>
<p><img src="https://pic.imgdb.cn/item/6205c4ac2ab3f51d9106c765.jpg" style="zoom:25%;" /></p>
<hr />
<p>注意</p>
<p>因为 DOM 元素 <code>&lt;button&gt;</code> 是一个内置组件，因此其 <code>onClick</code> 属性在 React 中有特殊的含义。而对于用户自定义的组件来说，命名就可以由用户自己来定义了。我们给 Square 的 <code>onClick</code> 和 Board 的 <code>handleClick</code> 赋予任意的名称，代码依旧有效。在 React 中，有一个命名规范，通常会将代表事件的监听 prop 命名为 <code>on[Event]</code>，将处理事件的监听方法命名为 <code>handle[Event]</code> 这样的格式。</p>
<hr />
<p>我们现在来向 Board 里添加 <code>handleClick</code> 方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.slice();</span><br><span class="line">   squares[i] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">   <span class="built_in">this</span>.setState(&#123;<span class="attr">squares</span>: squares&#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>现在，我们可以通过点击 Square 来填充那些方格，效果与之前相同。但是，当前 state 没有保存在单个的 Square 组件中，而是保存在了 Board 组件中。每当 Board 的 state 发生变化的时候，这些 Square 组件都会重新渲染一次。把所有 Square 的 state 保存在 Board 组件中可以让我们在将来判断出游戏的胜者。</p>
<p>因为 Square 组件不再持有 state，因此每次它们被点击的时候，Square 组件就会从 Board 组件中接收值，并且通知 Board 组件。在 React 术语中，我们把目前的 Square 组件称做“受控组件”。在这种情况下，Board 组件完全控制了 Square 组件。</p>
<p>注意，我们调用了 <code>.slice()</code> 方法创建了 <code>squares</code> 数组的一个副本，而不是直接在现有的数组上进行修改。在下一节，我们会介绍为什么我们需要创建 <code>square</code> 数组的副本。</p>
<h2 id="为什么不可变性在-react-中非常重要">为什么不可变性在 React 中非常重要</h2>
<p>在上一节内容当中，我们建议使用 <code>.slice()</code> 函数对 <code>squares</code> 数组进行拷贝，而非直接修改现有的数组。接下来我们来学习不可变性以及不可变性的重要性。</p>
<p>一般来说，有两种改变数据的方式。第一种方式是直接<em>修改</em>变量的值，第二种方式是使用新的一份数据替换旧数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 直接修改</span></span><br><span class="line"><span class="keyword">var</span> player = &#123;<span class="attr">score</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Jeff&#x27;</span>&#125;;</span><br><span class="line">player.score = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// player 修改后的值为 &#123;score: 2, name: &#x27;Jeff&#x27;&#125;</span></span><br><span class="line">----------------</span><br><span class="line"><span class="comment">// 新数据替换旧数据</span></span><br><span class="line"><span class="keyword">var</span> player = &#123;<span class="attr">score</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Jeff&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newPlayer = <span class="built_in">Object</span>.assign(&#123;&#125;, player, &#123;<span class="attr">score</span>: <span class="number">2</span>&#125;);</span><br><span class="line"><span class="comment">// player 的值没有改变, 但是 newPlayer 的值是 &#123;score: 2, name: &#x27;Jeff&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用对象展开语法，就可以写成：</span></span><br><span class="line"><span class="comment">// var newPlayer = &#123;...player, score: 2&#125;;</span></span><br></pre></td></tr></table></figure>
<p>不直接修改（或改变底层数据）这种方式和前一种方式的结果是一样的，这种方式有以下几点好处：</p>
<ul>
<li>简化复杂的功能</li>
</ul>
<p>不可变性使得复杂的特性更容易实现。在后面的章节里，我们会实现一种叫做“时间旅行”的功能。“时间旅行”可以使我们回顾井字棋的历史步骤，并且可以“跳回”之前的步骤。这个功能并不是只有游戏才会用到——撤销和恢复功能在开发中是一个很常见的需求。不直接在数据上修改可以让我们追溯并复用游戏的历史记录。</p>
<ul>
<li>跟踪数据的改变</li>
</ul>
<p>如果直接修改数据，那么就很难跟踪到数据的改变。跟踪数据的改变需要可变对象可以与改变之前的版本进行对比，这样整个对象树都需要被遍历一次。</p>
<p>跟踪不可变数据的变化相对来说就容易多了。如果发现对象变成了一个新对象，那么我们就可以说对象发生改变了。</p>
<ul>
<li>确定在 React 中何时重新渲染</li>
</ul>
<p>不可变性最主要的优势在于它可以帮助我们在 React 中创建 <em>pure components</em>。我们可以很轻松的确定不可变数据是否发生了改变，从而确定何时对组件进行重新渲染。</p>
<p>查阅<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/optimizing-performance.html#examples">性能优化</a>章节，以了解更多有关 <code>shouldComponentUpdate()</code> 函数及如何构建 <em>pure components</em> 的内容。</p>
<h2 id="函数组件">函数组件</h2>
<p>接下来我们把 Square 组件重写为一个<strong>函数组件</strong>。</p>
<p>如果你想写的组件只包含一个 <code>render</code> 方法，并且不包含 state，那么使用<strong>函数组件</strong>就会更简单。我们不需要定义一个继承于 <code>React.Component</code> 的类，我们可以定义一个函数，这个函数接收 <code>props</code> 作为参数，然后返回需要渲染的元素。函数组件写起来并不像 class 组件那么繁琐，很多组件都可以使用函数组件来写。</p>
<p>把 Square 类替换成下面的函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;props.value&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们把两个 <code>this.props</code> 都替换成了 <code>props</code>。</p>
<hr />
<ul>
<li><p>注意</p>
<p>当我们把 Square 修改成函数组件时，我们同时也把 <code>onClick=&#123;() =&gt; this.props.onClick()&#125;</code> 改成了更短的 <code>onClick=&#123;props.onClick&#125;</code>（注意两侧<em>都</em>没有括号）。</p></li>
</ul>
<hr />
<h2 id="轮流落子">轮流落子</h2>
<p>现在井字棋还有一个明显的缺陷有待完善：目前还不能在棋盘上标记 “O”。</p>
<p>我们将 “X” 默认设置为先手棋。你可以通过修改 Board 组件的构造函数中的初始 state 来设置默认的第一步棋子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">squares</span>: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">      <span class="attr">xIsNext</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>棋子每移动一步，<code>xIsNext</code>（布尔值）都会反转，该值将确定下一步轮到哪个玩家，并且游戏的状态会被保存下来。我们将通过修改 Board 组件的 <code>handleClick</code> 函数来反转 <code>xIsNext</code> 的值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.slice();</span><br><span class="line">  squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">    <span class="attr">squares</span>: squares,</span><br><span class="line">    <span class="attr">xIsNext</span>: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来修改 Board 组件 <code>render</code> 方法中 “status” 的值，这样就可以显示下一步是哪个玩家的了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> status = <span class="string">&#x27;Next player: &#x27;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     <span class="comment">// 其他部分没有改变</span></span><br></pre></td></tr></table></figure>
<p>修改之后，我们就实现了 “X” 和 “O” 轮流落子的效果。</p>
<p>这一步能实现下棋了，但是一个位置能点无穷次，还完全没有逻辑，和我写的军棋一样。</p>
<h2 id="判断出胜者">判断出胜者</h2>
<p>至此我们就可以看出下一步会轮到哪位玩家，与此同时，我们还需要显示游戏的结果来判定游戏结束。<del>拷贝如下 calculateWinner 函数并粘贴到文件底部：</del></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateWinner</span>(<span class="params">squares</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> lines = [</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>],</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> [a, b, c] = lines[i];</span><br><span class="line">    <span class="keyword">if</span> (squares[a] &amp;&amp; squares[a] === squares[b] &amp;&amp; squares[a] === squares[c]) &#123;</span><br><span class="line">      <span class="keyword">return</span> squares[a];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>传入长度为 9 的数组，此函数将判断出获胜者，并根据情况返回 “X”，“O” 或 “null”。</p>
<p>接着，在 Board 组件的 <code>render</code> 方法中调用 <code>calculateWinner(squares)</code> 检查是否有玩家胜出。一旦有一方玩家胜出，就把获胜玩家的信息显示出来，比如，“胜者：X” 或者“胜者：O”。现在，我们把 Board 的 <code>render</code> 函数中的 status 的定义修改为如下代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> winner = calculateWinner(<span class="built_in">this</span>.state.squares);</span><br><span class="line">   <span class="keyword">let</span> status;</span><br><span class="line">   <span class="keyword">if</span> (winner) &#123;</span><br><span class="line">     status = <span class="string">&#x27;Winner: &#x27;</span> + winner;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     status = <span class="string">&#x27;Next player: &#x27;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     <span class="comment">// 其他部分没有修改</span></span><br></pre></td></tr></table></figure>
<p>最后，修改 <code>handleClick</code> 事件，当有玩家胜出时，或者某个 Square 已经被填充时，该函数不做任何处理直接返回。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.slice();</span><br><span class="line">  <span class="keyword">if</span> (calculateWinner(squares) || squares[i]) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">    <span class="attr">squares</span>: squares,</span><br><span class="line">    <span class="attr">xIsNext</span>: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>恭喜！现在你已经完成了井字棋！除此之外，你也已经掌握了 React 的基本常识。所以坚持到这一步的你才是真正的赢家呀！</p>
<h1 id="时间旅行">时间旅行</h1>
<p>接下来是最后一个练习，我们将实现“回到过去”的功能，从而在游戏里跳回到历史步骤。</p>
<h2 id="保存历史记录">保存历史记录</h2>
<p>如果我们直接修改了 <code>square</code> 数组，实现时间旅行就会变得很棘手了。</p>
<p>不过，我们可以使用 <code>slice()</code> 函数为每一步创建 <code>squares</code> 数组的副本，同时把这个数组<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/tutorial/tutorial.html#why-immutability-is-important">当作不可变对象</a>。这样我们就可以把所有 <code>squares</code> 数组的历史版本都保存下来了，然后可以在历史的步骤中随意跳转。</p>
<p>我们把历史的 <code>squares</code> 数组保存在另一个名为 <code>history</code> 的数组中。<code>history</code> 数组保存了从第一步到最后一步的所有的棋盘状态。<code>history</code> 数组的结构如下所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">history = [</span><br><span class="line">  <span class="comment">// 第一步之前</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">squares</span>: [</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 第一步之后</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">squares</span>: [</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="string">&#x27;X&#x27;</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 第二步之后</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">squares</span>: [</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="string">&#x27;X&#x27;</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="string">&#x27;O&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>现在，我们需要确定应该在哪一个组件里保存 <code>history</code> 这个 state。</p>
<h2 id="再次提升状态">再次提升状态</h2>
<p>我们希望顶层 Game 组件展示出一个历史步骤的列表。这个功能需要访问 <code>history</code> 的数据，因此我们把 <code>history</code> 这个 state 放在顶层 Game 组件中。</p>
<p>我们把 <code>history</code> state 放在了 Game 组件中，这样就可以从它的子组件 Board 里面删除掉 <code>square</code> 中的 state。正如我们把 Square 组件的<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/tutorial/tutorial.html#lifting-state-up">状态提升</a>到 Board 组件一样，现在我们来把 state 从 Board 组件提升到顶层的 Game 组件里。这样，Game 组件就拥有了对 Board 组件数据的完全控制权，除此之外，还可以让 Game 组件控制 Board 组件，并根据 <code>history</code> 渲染历史步骤。</p>
<p>首先，我们在 Game 组件的构造函数中初始化 state：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">history</span>: [&#123;</span><br><span class="line">        <span class="attr">squares</span>: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">      &#125;],</span><br><span class="line">      <span class="attr">xIsNext</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Board</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* status */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">ol</span>&gt;</span>&#123;/* TODO */&#125;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下一步，我们让 Board 组件从 Game 组件中接收 <code>squares</code> 和 <code>onClick</code> 这两个 props。因为当前在 Board 组件中已经有一个对 Square 点击事件的监听函数了，所以我们需要把每一个 Square 的对应位置传递给 <code>onClick</code> 监听函数，这样监听函数就知道具体哪一个 Square 被点击了。以下是修改 Board 组件的几个必要步骤：</p>
<ul>
<li>删除 Board 组件中的 <code>constructor</code> 构造函数。</li>
<li>把 Board 组件的 <code>renderSquare</code> 中的 <code>this.state.squares[i]</code> 替换为 <code>this.props.squares[i]</code>。</li>
<li>把 Board 组件的 <code>renderSquare</code> 中的 <code>this.handleClick(i)</code> 替换为 <code>this.props.onClick(i)</code>。</li>
</ul>
<p>接着，更新 Game 组件的 <code>render</code> 函数，使用最新一次历史记录来确定并展示游戏的状态：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">  <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> winner = calculateWinner(current.squares);</span><br><span class="line">  <span class="keyword">let</span> status;</span><br><span class="line">  <span class="keyword">if</span> (winner) &#123;</span><br><span class="line">    status = <span class="string">&#x27;Winner: &#x27;</span> + winner;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    status = <span class="string">&#x27;Next player: &#x27;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Board</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">squares</span>=<span class="string">&#123;current.squares&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">onClick</span>=<span class="string">&#123;(i)</span> =&gt;</span> this.handleClick(i)&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;status&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ol</span>&gt;</span>&#123;/* TODO */&#125;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于 Game 组件渲染了游戏的状态，因此我们可以将 Board 组件 <code>render</code> 方法中对应的代码移除。修改之后，Board 组件的 <code>render</code> 函数如下所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(0)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(1)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(2)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(3)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(4)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(5)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(6)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(7)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(8)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，我们需要把 Board 组件的 <code>handleClick</code> 方法移到 Game 组件中。同时，我们也需要修改一下 <code>handleClick</code> 方法，因为这两个组件的 state 在结构上有所不同。在 Game 组件的 <code>handleClick</code> 方法中，我们需要把新的历史记录拼接到 <code>history</code> 上。</p>
<hr />
<ul>
<li><p>注意</p>
<p><code>concat()</code> 方法可能与<del>你比较熟悉的</del> <code>push()</code> 方法不太一样，它并不会改变原数组，所以我们推荐使用 <code>concat()</code>。</p></li>
</ul>
<hr />
<p>到目前为止，Board 组件只需要 <code>renderSquare</code> 和 <code>render</code> 这两个方法。而游戏的状态和 <code>handleClick</code> 方法则会放在 Game 组件当中。</p>
<hr />
<p>我自己不知道哪儿写出了 bug，本地没保存 git，然后用 jetbrain 的 local history revert 回去，强行把代码粘贴回去</p>
<p><a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/EmmOqJ?editors=0010">把这一段代码粘贴到自己的 index.js</a>，注意保存开头的声明：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reportWebVitals <span class="keyword">from</span> <span class="string">&#x27;./reportWebVitals&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="展示历史步骤记录">展示历史步骤记录</h2>
<p>由于我们已经记录了井字棋的历史记录，因此我们可以把这些记录以历史步骤列表的形式展示给玩家。</p>
<p>在前文中提到的 React 元素被视为 JavaScript 一等公民中的对象（first-class JavaScript objects），因此我们可以把 React 元素在应用程序中当作参数来传递。在 React 中，我们还可以使用 React 元素的数组来渲染多个元素。</p>
<p>在 JavaScript 中，数组拥有 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code>map()</code> 方法</a>，该方法通常用于把某数组映射为另一个数组，例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> doubled = numbers.map(<span class="function"><span class="params">x</span> =&gt;</span> x * <span class="number">2</span>); <span class="comment">// [2, 4, 6]</span></span><br></pre></td></tr></table></figure>
<p>我们可以通过使用 <code>map</code> 方法，把历史步骤映射为代表按钮的 React 元素，然后可以展示出一个按钮的列表，点击这些按钮，可以“跳转”到对应的历史步骤。</p>
<p>现在，我们在 Game 组件的 <code>render</code> 方法中调用 <code>history</code> 的 <code>map</code> 方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">    <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">const</span> winner = calculateWinner(current.squares);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> moves = history.map(<span class="function">(<span class="params">step, move</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> desc = move ?</span><br><span class="line">        <span class="string">&#x27;Go to move #&#x27;</span> + move :</span><br><span class="line">        <span class="string">&#x27;Go to game start&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.jumpTo(move)&#125;&gt;&#123;desc&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> status;</span><br><span class="line">    <span class="keyword">if</span> (winner) &#123;</span><br><span class="line">      status = <span class="string">&#x27;Winner: &#x27;</span> + winner;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      status = <span class="string">&#x27;Next player: &#x27;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Board</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">squares</span>=<span class="string">&#123;current.squares&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">onClick</span>=<span class="string">&#123;(i)</span> =&gt;</span> this.handleClick(i)&#125;</span></span><br><span class="line"><span class="xml">          /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;status&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">ol</span>&gt;</span>&#123;moves&#125;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>当我们遍历 <code>history</code> 数组时，<code>step</code> 变量指向的是当前 <code>history</code> 元素的值，而 <code>move</code> 则指向的是 <code>history</code> 元素的索引。此处，我们只对 <code>move</code> 感兴趣，因此未对 <code>step</code> 做任何处理。</p>
<p>对于井字棋历史记录的每一步，我们都创建出了一个包含按钮 <code>&lt;button&gt;</code> 元素的 <code>&lt;li&gt;</code> 的列表。这些按钮拥有一个 <code>onClick</code> 事件处理函数，在这个函数里调用了 <code>this.jumpTo()</code> 方法。但是我们还没有实现 <code>jumpTo()</code> 方法。到目前为止，我们可以看到一个游戏历史步骤的列表，以及开发者工具控制台的警告信息，警告信息如下：</p>
<hr />
<p><strong>Warning: Each child in an array or iterator should have a unique “key” prop. Check the render method of “Game”.</strong></p>
<hr />
<h2 id="选择一个-key">选择一个 key</h2>
<p>当我们需要渲染一个列表的时候，React 会存储这个列表每一项的相关信息。当我们要更新这个列表时，React 需要确定哪些项发生了改变。我们有可能增加、删除、重新排序或者更新列表项。</p>
<p>想象一下把下面的代码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Alexa: 7 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Ben: 5 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>转换成下面的代码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Ben: 9 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Claudia: 8 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Alexa: 5 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除了数字发生了改变之外，阅读这段代码的人也许会认为我们把 Alexa 和 Ben 的顺序交换了位置，然后把 Claudia 插入到 Alexa 和 Ben 之间。然而，React 是电脑程序，它并不知道我们想要什么。因为 React 无法得知我们人类的意图，所以我们需要给每一个列表项一个确定的 <em>key</em> 属性，它可以用来区分不同的列表项和他们的同级兄弟列表项。你可以使用字符串，比如 <code>alexa</code>, <code>ben</code>, <code>claudia</code>。如果我们使用从数据库里获取的数据，那么 Alexa、Ben 和 Claudia 的数据库 ID 就可以作为 key 来使用。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;user.id&#125;</span>&gt;</span>&#123;user.name&#125;: &#123;user.taskCount&#125; tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>每当一个列表重新渲染时，React 会根据每一项列表元素的 key 来检索上一次渲染时与每个 key 所匹配的列表项。如果 React 发现当前的列表有一个之前不存在的 key，那么就会创建出一个新的组件。如果 React 发现和之前对比少了一个 key，那么就会销毁之前对应的组件。如果一个组件的 key 发生了变化，这个组件会被销毁，然后使用新的 state 重新创建一份。</p>
<p><code>key</code> 是 React 中一个特殊的保留属性（还有一个是 <code>ref</code>，拥有更高级的特性）。当 React 元素被创建出来的时候，React 会提取出 <code>key</code> 属性，然后把 key 直接存储在返回的元素上。虽然 <code>key</code> 看起来好像是 <code>props</code> 中的一个，但是你不能通过 <code>this.props.key</code> 来获取 <code>key</code>。React 会通过 <code>key</code> 来自动判断哪些组件需要更新。组件是不能访问到它的 <code>key</code> 的。</p>
<p><strong>我们强烈推荐，每次只要你构建动态列表的时候，都要指定一个合适的 key。</strong>如果你没有找到一个合适的 key，那么你就需要考虑重新整理你的数据结构了，这样才能有合适的 key。</p>
<p>如果你没有指定任何 key，React 会发出警告，并且会把数组的索引当作默认的 key。但是如果想要对列表进行重新排序、新增、删除操作时，把数组索引作为 key 是有问题的。显式地使用 <code>key=&#123;i&#125;</code> 来指定 key 确实会消除警告，但是仍然和数组索引存在同样的问题，所以大多数情况下最好不要这么做。</p>
<p>组件的 key 值并不需要在全局都保证唯一，只需要在当前的同一级元素之前保证唯一即可。</p>
<h2 id="实现时间旅行">实现时间旅行</h2>
<p>在井字棋的历史记录中，每一个历史步骤都有一个与之对应的唯一 ID：这个 ID 就是每一步棋的序号。因为历史步骤不需要重新排序、新增、删除，所以使用步骤的索引作为 <code>key</code> 是安全的。</p>
<p>在 Game 组件的 <code>render</code> 方法中，我们可以这样添加 key，<code>&lt;li key=&#123;move&#125;&gt;</code>，这样关于 key 的警告就会消失了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> moves = history.map(<span class="function">(<span class="params">step, move</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> desc = move ?</span><br><span class="line">    <span class="string">&#x27;Go to move #&#x27;</span> + move :</span><br><span class="line">    <span class="string">&#x27;Go to game start&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;move&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.jumpTo(move)&#125;&gt;&#123;desc&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>因为 <code>jumpTo</code> 还未定义，所以你点击列表项的按钮时，会出现报错。在我们实现 <code>jumpTo</code> 之前，我们向 Game 组件的 state 中添加 <code>stepNumber</code>，这个值代表我们当前正在查看哪一项历史记录。</p>
<p>首先，我们在 Game 的构造函数 <code>constructor</code> 中向初始 state 中添加 <code>stepNumber: 0</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">history</span>: [&#123;</span><br><span class="line">        <span class="attr">squares</span>: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">      &#125;],</span><br><span class="line">      <span class="attr">stepNumber</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">xIsNext</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>然后，我们在 Game 组件中定义 <code>jumpTo</code> 方法以更新状态 <code>stepNumber</code>。除此之外，当状态 <code>stepNumber</code> 是偶数时，我们还要把 <code>xIsNext</code> 设为 true：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 这个方法无更改</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">jumpTo</span>(<span class="params">step</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">    <span class="attr">stepNumber</span>: step,</span><br><span class="line">    <span class="attr">xIsNext</span>: (step % <span class="number">2</span>) === <span class="number">0</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 这个方法无更改</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>jumpTo</code> 方法中, 我们没有更新 state 中的 <code>history</code> 属性。这是因为 state 更新被合并了，或者用更简单的话说，React 不会更新 <code>setState</code> 方法中未提到的属性。 <strong><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/state-and-lifecycle.html#state-updates-are-merged">这篇文档</a></strong>对此有更详细的介绍。</p>
<p>接下来，我们还要修改 Game 组件的 <code>handleClick</code> 方法，当你点击方格的时候触发该方法。</p>
<p>新添加的 <code>stepNumber</code> state 用于给用户展示当前的步骤。每当我们落下一颗新棋子的时候，我们需要调用 <code>this.setState</code> 并传入参数 <code>stepNumber: history.length</code>，以更新 <code>stepNumber</code>。这就保证了保证每走一步 <code>stepNumber</code> 会跟着改变。</p>
<p>我们还把读取 <code>this.state.history</code> 换成了读取 <code>this.state.history.slice(0, this.state.stepNumber + 1)</code> 的值。如果我们“回到过去”，然后再走一步新棋子，原来的“未来”历史记录就不正确了，这个替换可以保证我们把这些“未来”的不正确的历史记录丢弃掉。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history.slice(<span class="number">0</span>, <span class="built_in">this</span>.state.stepNumber + <span class="number">1</span>);</span><br><span class="line">   <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">   <span class="keyword">const</span> squares = current.squares.slice();</span><br><span class="line">   <span class="keyword">if</span> (calculateWinner(squares) || squares[i]) &#123;</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">   <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">     <span class="attr">history</span>: history.concat([&#123;</span><br><span class="line">       <span class="attr">squares</span>: squares</span><br><span class="line">     &#125;]),</span><br><span class="line">     <span class="attr">stepNumber</span>: history.length,</span><br><span class="line">     <span class="attr">xIsNext</span>: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>最后，修改 Game 组件的 <code>render</code> 方法，将代码从始终根据最后一次移动渲染修改为根据当前 <code>stepNumber</code> 渲染。</p>
<h2 id="总结">总结</h2>
<p>恭喜你！你已经完成了一个拥有以下功能的井字棋啦：</p>
<ul>
<li>tic-tac-toe(三连棋)游戏的所有功能</li>
<li>能够判定玩家何时获胜</li>
<li>能够记录游戏进程</li>
<li>允许玩家查看游戏的历史记录，也可以查看任意一个历史版本的游戏棋盘状态</li>
</ul>
<p>干的不错！我们希望你至此已经基本掌握了 React 的使用——<strong><a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/gWWZgR?editors=0010">最终成果</a></strong>.</p>
<p>如果你还有充裕的时间，或者想练习一下刚刚学会的 React 新技能，这里有一些可以改进游戏的想法供你参考，这些功能的实现顺序的难度是递增的：</p>
<ol type="1">
<li>在游戏历史记录列表显示每一步棋的坐标，格式为 (列号, 行号)。</li>
<li>在历史记录列表中加粗显示当前选择的项目。</li>
<li>使用两个循环来渲染出棋盘的格子，而不是在代码里写死（hardcode）。</li>
<li>添加一个可以升序或降序显示历史记录的按钮。</li>
<li>每当有人获胜时，高亮显示连成一线的 3 颗棋子。</li>
<li>当无人获胜时，显示一个平局的消息。</li>
</ol>
<p>通过这篇教程，我们接触了 React 中的一些概念，比如 React 元素、React 组件、props，还有 state。更多关于这些概念的细节的解释，参考<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/hello-world.html">文档的其他部分</a>。了解更多关于组件定义的内容，参考<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/react-component.html"><code>React.Component</code> API reference</a>。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Eren Zhao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/02/10/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/react_tutorial/">http://example.com/2022/02/10/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/react_tutorial/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/2022%E5%AF%92%E5%81%87/">2022寒假</a><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/%E8%BD%AF%E5%B7%A5/">软工</a><a class="post-meta__tags" href="/tags/JavaScript/">JavaScript</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/03/08/jPxmqXH5YvbsgOu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/16/CS/others/python_decorator/"><img class="prev-cover" src="https://pic.imgdb.cn/item/61f106922ab3f51d917b2b9f.jpg" onerror="onerror=null;src='https://wkphoto.cdn.bcebos.com/1f178a82b9014a9058a735deb9773912b31bee3c.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">decorator Python装饰器</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/08/%E9%9A%8F%E7%AC%94/%E5%BF%83%E5%BF%83%E5%BF%B5%E5%BF%B5/Say%20Something%20for%20Spring%202022/"><img class="next-cover" src="https://pic.imgdb.cn/item/620540f92ab3f51d91b65009.jpg" onerror="onerror=null;src='https://wkphoto.cdn.bcebos.com/1f178a82b9014a9058a735deb9773912b31bee3c.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Say Something for Spring 2022</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/01/08/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/javascript/" title="JavaScript part 1"><img class="cover" src="https://pic.imgdb.cn/item/623475d95baa1a80ab3b102b.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-08</div><div class="title">JavaScript part 1</div></div></a></div><div><a href="/2022/01/30/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/javascript_part_3/" title="JavaScript part 3"><img class="cover" src="https://pic.imgdb.cn/item/61eccb4d2ab3f51d91d616f7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-30</div><div class="title">JavaScript part 3</div></div></a></div><div><a href="/2022/01/18/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/javascript_part_2/" title="JavaScript part 2"><img class="cover" src="https://pic.imgdb.cn/item/61eccc242ab3f51d91d6d7ab.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-18</div><div class="title">JavaScript part 2</div></div></a></div><div><a href="/2022/02/01/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/javascript_finale/" title="JavaScript finale"><img class="cover" src="https://pic.imgdb.cn/item/61f0fc772ab3f51d9173149e.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-01</div><div class="title">JavaScript finale</div></div></a></div><div><a href="/2022/02/19/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/addAnonymityFeedback/" title="Tsing-answer 开发匿名反馈"><img class="cover" src="https://pic.imgdb.cn/item/61eccc4f2ab3f51d91d6fcba.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-19</div><div class="title">Tsing-answer 开发匿名反馈</div></div></a></div><div><a href="/2022/01/26/CS/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/tsing_ans/" title="答疑坊小程序开发记录"><img class="cover" src="https://pic.imgdb.cn/item/61ed143f2ab3f51d911d4294.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-26</div><div class="title">答疑坊小程序开发记录</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend.jpg'" alt="avatar"/></div><div class="author-info__name">Eren Zhao</div><div class="author-info__description">求道之人，不论寒暑，无问西东</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">168</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">53</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zhaochenyang20"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">La vida sola viviras</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#readme"><span class="toc-number">1.</span> <span class="toc-text">readme</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%89%8D%E8%A8%80"><span class="toc-number">2.</span> <span class="toc-text">课程前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%AD%E7%8E%AF%E5%A2%83"><span class="toc-number">3.</span> <span class="toc-text">搭环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#javascript-%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E9%93%BE"><span class="toc-number">4.</span> <span class="toc-text">JavaScript 构建工具链</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#npm-%E6%8D%A2%E6%BA%90"><span class="toc-number">5.</span> <span class="toc-text">npm 换源</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">6.</span> <span class="toc-text">概览</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#what-is-react"><span class="toc-number">6.1.</span> <span class="toc-text">What is React</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">6.2.</span> <span class="toc-text">初始代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-props-%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE"><span class="toc-number">6.3.</span> <span class="toc-text">通过 Props 传递数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%99%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BD"><span class="toc-number">6.4.</span> <span class="toc-text">给组件添加交互功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7"><span class="toc-number">6.5.</span> <span class="toc-text">开发者工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E5%AE%8C%E5%96%84"><span class="toc-number">7.</span> <span class="toc-text">游戏完善</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87"><span class="toc-number">7.1.</span> <span class="toc-text">状态提升</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%80%A7%E5%9C%A8-react-%E4%B8%AD%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81"><span class="toc-number">7.2.</span> <span class="toc-text">为什么不可变性在 React 中非常重要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6"><span class="toc-number">7.3.</span> <span class="toc-text">函数组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AE%E6%B5%81%E8%90%BD%E5%AD%90"><span class="toc-number">7.4.</span> <span class="toc-text">轮流落子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%87%BA%E8%83%9C%E8%80%85"><span class="toc-number">7.5.</span> <span class="toc-text">判断出胜者</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%97%85%E8%A1%8C"><span class="toc-number">8.</span> <span class="toc-text">时间旅行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-number">8.1.</span> <span class="toc-text">保存历史记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E6%8F%90%E5%8D%87%E7%8A%B6%E6%80%81"><span class="toc-number">8.2.</span> <span class="toc-text">再次提升状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E5%8E%86%E5%8F%B2%E6%AD%A5%E9%AA%A4%E8%AE%B0%E5%BD%95"><span class="toc-number">8.3.</span> <span class="toc-text">展示历史步骤记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA-key"><span class="toc-number">8.4.</span> <span class="toc-text">选择一个 key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%97%B6%E9%97%B4%E6%97%85%E8%A1%8C"><span class="toc-number">8.5.</span> <span class="toc-text">实现时间旅行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">8.6.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/07/%E9%9A%8F%E7%AC%94/%E5%8D%9A%E6%96%87/%E7%BE%8E%E5%9B%BD%E9%A1%B6%E5%B0%96%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%BA%90%E8%B7%9F%E6%B8%85%E5%8C%97%E5%A4%8D%E4%BA%A4%E6%AF%94%E6%80%8E%E4%B9%88%E6%A0%B7/" title="中国顶尖大学新生比康奈尔新生优秀，但4年后被康奈尔毕业生超越"><img src="https://pic.imgdb.cn/item/6234762a5baa1a80ab3bbe9b.jpg" onerror="this.onerror=null;this.src='https://wkphoto.cdn.bcebos.com/1f178a82b9014a9058a735deb9773912b31bee3c.jpg'" alt="中国顶尖大学新生比康奈尔新生优秀，但4年后被康奈尔毕业生超越"/></a><div class="content"><a class="title" href="/2022/05/07/%E9%9A%8F%E7%AC%94/%E5%8D%9A%E6%96%87/%E7%BE%8E%E5%9B%BD%E9%A1%B6%E5%B0%96%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%BA%90%E8%B7%9F%E6%B8%85%E5%8C%97%E5%A4%8D%E4%BA%A4%E6%AF%94%E6%80%8E%E4%B9%88%E6%A0%B7/" title="中国顶尖大学新生比康奈尔新生优秀，但4年后被康奈尔毕业生超越">中国顶尖大学新生比康奈尔新生优秀，但4年后被康奈尔毕业生超越</a><time datetime="2022-05-07T14:17:15.505Z" title="Created 2022-05-07 22:17:15">2022-05-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/06/%E7%A3%95%E7%9B%90/Enhancing%20photorealism%20enhancement/" title="Enhancing photorealism enhancement"><img src="https://pic.imgdb.cn/item/62270f345baa1a80ab39c24c.jpg" onerror="this.onerror=null;this.src='https://wkphoto.cdn.bcebos.com/1f178a82b9014a9058a735deb9773912b31bee3c.jpg'" alt="Enhancing photorealism enhancement"/></a><div class="content"><a class="title" href="/2022/05/06/%E7%A3%95%E7%9B%90/Enhancing%20photorealism%20enhancement/" title="Enhancing photorealism enhancement">Enhancing photorealism enhancement</a><time datetime="2022-05-06T00:10:47.561Z" title="Created 2022-05-06 08:10:47">2022-05-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/02/%E9%9A%8F%E7%AC%94/%E6%B8%85%E5%8D%8E%E5%9B%AD%E6%97%A5%E8%AE%B0/%E6%B8%85%E5%8D%8E%E5%9B%AD%E6%97%A5%E8%AE%B0--%E7%AC%AC%E5%9B%9B%E9%83%A8/" title="清华园日记——第四部"><img src="https://pic.imgdb.cn/item/61eccb202ab3f51d91d5f178.jpg" onerror="this.onerror=null;this.src='https://wkphoto.cdn.bcebos.com/1f178a82b9014a9058a735deb9773912b31bee3c.jpg'" alt="清华园日记——第四部"/></a><div class="content"><a class="title" href="/2022/05/02/%E9%9A%8F%E7%AC%94/%E6%B8%85%E5%8D%8E%E5%9B%AD%E6%97%A5%E8%AE%B0/%E6%B8%85%E5%8D%8E%E5%9B%AD%E6%97%A5%E8%AE%B0--%E7%AC%AC%E5%9B%9B%E9%83%A8/" title="清华园日记——第四部">清华园日记——第四部</a><time datetime="2022-05-01T23:08:23.503Z" title="Created 2022-05-02 07:08:23">2022-05-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/25/%E9%9A%8F%E7%AC%94/%E5%BF%83%E5%BF%83%E5%BF%B5%E5%BF%B5/%E6%B1%82%E9%81%93%E4%B9%8B%E4%BA%BA/" title="求道之人，不问寒暑"><img src="https://pic.imgdb.cn/item/623475e95baa1a80ab3b366f.jpg" onerror="this.onerror=null;this.src='https://wkphoto.cdn.bcebos.com/1f178a82b9014a9058a735deb9773912b31bee3c.jpg'" alt="求道之人，不问寒暑"/></a><div class="content"><a class="title" href="/2022/04/25/%E9%9A%8F%E7%AC%94/%E5%BF%83%E5%BF%83%E5%BF%B5%E5%BF%B5/%E6%B1%82%E9%81%93%E4%B9%8B%E4%BA%BA/" title="求道之人，不问寒暑">求道之人，不问寒暑</a><time datetime="2022-04-25T00:12:06.667Z" title="Created 2022-04-25 08:12:06">2022-04-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/24/%E9%9A%8F%E7%AC%94/%E5%BF%83%E5%BF%83%E5%BF%B5%E5%BF%B5/aniversary/" title="分流转系后的一整年"><img src="https://pic.imgdb.cn/item/61eccb5c2ab3f51d91d6238c.jpg" onerror="this.onerror=null;this.src='https://wkphoto.cdn.bcebos.com/1f178a82b9014a9058a735deb9773912b31bee3c.jpg'" alt="分流转系后的一整年"/></a><div class="content"><a class="title" href="/2022/04/24/%E9%9A%8F%E7%AC%94/%E5%BF%83%E5%BF%83%E5%BF%B5%E5%BF%B5/aniversary/" title="分流转系后的一整年">分流转系后的一整年</a><time datetime="2022-04-24T13:17:30.403Z" title="Created 2022-04-24 21:17:30">2022-04-24</time></div></div></div></div></div></div></main><footer id="footer" style="background: ＃191970"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Eren Zhao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>